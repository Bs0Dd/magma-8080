[English](https://github.com/Bs0Dd/magma-8080/blob/main/MAC/README.md) | Русский

# Магма - Режим выработки имитовставки (MAC)

Реализация режима выработки имитовставки для процессора КР580ВМ80А (Intel 8080A).

* Шифрование/дешифрование блоками по **64 бита**.
* Ключ **256 бит**.
* Затраты: **~156 000 тактов** за один вызов (**~16 вызовов/с**).
* Скорость шифрования/дешифрования: до **1 Кбит/с**.


## Набор подпрограмм

Для облегчения использования алгоритма основные подпрограммы собраны в единую "библиотеку" - **imagma** [(.asm)](https://github.com/Bs0Dd/magma-8080/blob/main/MAC/imagma.asm) [(.bin)](https://github.com/Bs0Dd/magma-8080/blob/main/MAC/imagma.bin) [(.rk)](https://github.com/Bs0Dd/magma-8080/blob/main/MAC/imagma.rk).  
Программисту достаточно всего лишь вызывать нужные подпрограммы и читать результат по фиксированному адресу.  
Доступны 3 публичные подпрограммы и 2 публичных значения - для них действуют следующие адреса:

| Подпрограмма |                 Назначение                |   Адрес   |
| :----------: | :---------------------------------------: | :-------: |
|    magimi    | Доб. до им-ки 64-бит блока по адресу в HL | org + 0h  |
|    imrst     |           Cброс поля имитовставки         | org + 17h |
|    setkey    |       Установка ключа по адресу в HL      | org + 2Ah |

| Значение | Длина (байт) |     Описание    |   Адрес    |
| :------: | :----------: | :-------------: | :--------: |
|   key    |      32      | Ключ шифрования | org + 1CEh |
|  imito   |      8       |   Имитовставка  | org + 1EEh |


Файлы **bin** и **rk** подразумевают загрузку их кода по адресу **7000h**. Соответственно адреса:

| Название |  Адрес  |
| :------: | :-----: |
|  magimi  |  7000h  |
|  initiv  |  7017h  |
|  setkey  |  702Ah  |
|   key    |  71CEh  |
|  imito   |  71EEh  |


## Примеры

Примеры шифрующей программы (**Магма-Имито**):  
* **magma-imito-86rk** [(.asm)](https://github.com/Bs0Dd/magma-8080/blob/main/MAC/magma-imito-86rk.asm) [(.rk)](https://github.com/Bs0Dd/magma-8080/blob/main/MAC/magma-imito-86rk.rk) - Версия для ПЭВМ **Радио-86РК** (с выводом на дисплей)  
* **magma-imito-uni** [(.asm)](https://github.com/Bs0Dd/magma-8080/blob/main/MAC/magma-imito-uni.asm) [(.bin)](https://github.com/Bs0Dd/magma-8080/blob/main/MAC/magma-imito-uni.bin) - Не привязанная к конкретному устройству версия (**HLT** после конца программы)
